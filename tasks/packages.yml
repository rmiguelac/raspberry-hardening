---
- name: Make sure required packages are installed
  block:
  - name: Install packages
    ansible.builtin.package:
      name: "{{ item }}"
      state: present
    loop: "{{ service_packages }}"

  - name: Enable services to start at boot
    ansible.builtin.service:
      name: fail2ban
      enabled: true
    loop: "{{ service_packages }}"
  
  become: yes
  tags: packages